<p id="notice"><%= notice %></p>
<h1>User Information</h1>
<p>
  <b>Avatar:</b>
<%= image_tag @user.avatar.url(:medium) %>
</p>
<p>
  <b>Name:</b>
  <%= @user.name %>
</p>

<p>
  <b>Email:</b>
  <%= @user.email %>
</p>
<p>
	<b>List folders: </b><br/>
	<% @user.folders.each do |folder|%>
		<% if Folder.where(:user_id => current_user, :id => folder.id).exists? %>
			<a href="/folders/<%=folder.id%>&?user_id=<%=@user.id%>"><%= folder.name%></a><br/>
		<% else %>
			<% folder.foldersharings.each do |f|%>
				<% if Foldersharing.where(:shared_user_id => f.shared_user_id, :folder_id => f.folder_id).exists? %>
					<a href="/folders/<%=folder.id%>&?user_id=<%=@user.id%>"><%= folder.name%></a><br/>
				<% end %>
			<% end %>
		<% end %>
	<% end %>
</p>
<% if signed_in? %>
<% if current_user.id == params[:id].to_i %>
<p>
	<% @lists = Foldersharing.where(:shared_user_id => current_user) %>
	<b>List folders are shared by other members : </b><br/>
	<table class="table table-hover">

		<tr>
			<th>Folder name</th>
			<th>Share by</th>
			<th>Time</th>
		</tr>
			<% @lists.each do |list|%>
		<tr>
		<td><a href="/folders/<%=list.folder_id%>&?user_id=<%=current_user.id%>"><%= Folder.find(list.folder_id).name %></a></td>
		<td><%=User.find(Folder.find(list.folder_id).user_id).name%> (<%=User.find(Folder.find(list.folder_id).user_id).email%>)</td>
		<td><%= Foldersharing.find(list.id).created_at %></td>
		</tr>
	<% end %>
		</table>
</p>	<br/>
<p><b>List files are shared by others members: </b><br/>

    <table class="table table-hover">
    	<tr>
				<th>File name</th>
				<th>View file (image only)</th>
				<th>Download</th>
				<th>Share by</th>
				<th>Time</th>
			</tr>
		 	  <% listFiles = Filesharing.where(:shared_user_id => current_user) %>
		    <% listFiles.each do |file|%>
				  <td><%= Filestream.find(file.file_id).attach_file_name %></td>
				  <% if Filestream.find(file.file_id).attach_content_type.include? "image"%>
				   <td>
					<span><a href="#previewModal-<%=file.file_id%>" data-toggle="modal"><%= image_tag("preview.jpeg",:size => "30x30", alt: "Preview") %></a></span>
				</td>
				<div id="previewModal-<%=file.file_id%>" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="previewModalLabel" aria-hidden="true" data>
					<div class="modal-header">
						<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
						<h3 id="previewModalLabel"><%=Filestream.find(file.file_id).attach_file_name%></h3>
					</div>
					<div id="myCarousel" class="carousel slide">
					  	<ol class="carousel-indicators">


					<li data-target="#previewModal" data-slide-to="0" class="active">
<div class="modal-body">

							<%= image_tag Filestream.find(file.file_id).attach.url %>
						</div></li>


				</ol>
				 <div class="carousel-inner">
<div class="active item">…</div>
<div class="item">…</div>
<div class="item">…</div>
</div>

				</div>
				<div class="modal-footer">
						<button type="button" class="btn btn-large" onClick="location.href='/filestreams/<%=file.file_id%>/download'"><i class="icon-download icon-white"></i>Download</button>
					</div>
				</div>
					<%else%>
						<td></td>
					<%end%>
				<td><%= link_to 'Download', download_filestream_path(file.file_id) %></td>
				<td><%= User.find(Folder.find(Filestream.find(file.file_id).folder_id).user_id).name %> (<%= User.find(Folder.find(Filestream.find(file.file_id).folder_id).user_id).email %>)</td>
				<td><%= Filesharing.find_by_file_id(file.file_id).created_at %></td>
			<tr>
			</tr>
			<% end %>
    </table>
</p>
		<% end %><% end %>
		<% if signed_in? %>
		<% if current_user.id == params[:id].to_i %>
		<br/><br/><br/><br/>
		<%= link_to 'Edit', edit_user_path(@user) %> |
		<% end %><% end %>
		<%= link_to 'Back', users_path %>
		<% if signed_in? %>
		<% if current_user.id == params[:id].to_i %>
		| <a href="/folders">Create folder</a>
		<% end %><% end %>
